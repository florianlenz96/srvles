@page "/"
@using BlazorApp.Client.Services

<PageTitle>Free URL Shortener | by neocentric</PageTitle>
<link rel="stylesheet" type="text/css" href="css/Shortener.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />

<div id="shortener">
    <article class="content px-4" style="text-align: center">
        <h1>Free URL Shortener</h1>

        <p>srvl.es is a free tool to shorten URLs powered by neocentric. Create short & memorable links in seconds.</p>
        
        <EditForm Model="@url" OnValidSubmit="@Shorten">
            <input type="url" name="url" placeholder="Enter your URL" required @bind="url" />
            <button type="submit">Shorten</button>
        </EditForm>
        
        <div class="shorten-urls">
            @foreach (var shortUrl in shortUrls)
            {
                <div class="shortened-url">
                    <span class="origin-url">@shortUrl</span>
                    <a class="short-url" href="https://google.de" target="_blank">srvl.es/krzya</a>
                    <i class="icon bi bi-qr-code" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Tooltip on bottom"></i>
                    <i class="icon bi bi-clipboard" onclick="@CopyToClipboard(shortUrl)" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="Tooltip on bottom"></i>
                </div>
            }
        </div>
        
        <img src="neocentric.png" width="100" />
    </article>
</div>

@code {
    string url = string.Empty;
    List<string> shortUrls = new List<string>();
    
    [Inject]
    CookieStorageAccessor _storageAccessor { get; set; }
    
    [Inject]
    CopyAccessor _copyAccessor { get; set; }

    protected override async Task OnInitializedAsync()
    {
        var storedUrls = await _storageAccessor.GetValueAsync<List<string>>("shortUrls");
        if (storedUrls != null)
        {
            shortUrls = storedUrls;
        }
        
        await base.OnInitializedAsync();
    }

    async Task Shorten(EditContext editContext)
    {
        shortUrls.Add(editContext.Model.ToString()!);
        await _storageAccessor.SetValueAsync("shortUrls", shortUrls);
        url = string.Empty;
    }
    
    async Task CopyToClipboard(string url)
    {
        await _copyAccessor.CopyShortUrl(url);
    }

}